title: åŸºäºNettyçš„RPCæ¶æ„å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šNIO
author: Leesin.Dong
top: 
tags:

- Netty
categories:
- å­¦ä¹ ç¬”è®°
- åŸºäºNettyçš„RPCæ¶æ„å­¦ä¹ ç¬”è®°
date: 2019-3-10 10:21:01

---



# ä¼ ç»Ÿçš„socketåˆ†æ
## ä¸¾ä¸ªğŸŒ°

```js
package OIO;
import java.io.IOException;
import java.io.InputStream;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
/**
 * ä¼ ç»ŸsocketæœåŠ¡ç«¯
 * 
 *
 */
public class OioServer {

	@SuppressWarnings("resource")
	public static void main(String[] args) throws Exception {

		ExecutorService newCachedThreadPool = Executors.newCachedThreadPool();
		//åˆ›å»ºsocketæœåŠ¡,ç›‘å¬10101ç«¯å£
		ServerSocket server=new ServerSocket(10101);
		System.out.println("æœåŠ¡å™¨å¯åŠ¨ï¼");
		while(true){
			//è·å–ä¸€ä¸ªå¥—æ¥å­—ï¼ˆé˜»å¡ï¼‰
			final Socket socket = server.accept();
			System.out.println("æ¥ä¸ªä¸€ä¸ªæ–°å®¢æˆ·ç«¯ï¼");
			newCachedThreadPool.execute(new Runnable() {
				
				@Override
				public void run() {
					//ä¸šåŠ¡å¤„ç†
					handler(socket);
				}
			});
			
		}
	}
	
	/**
	 * è¯»å–æ•°æ®
	 * @param socket
	 * @throws Exception
	 */
	public static void handler(Socket socket){
			try {
				byte[] bytes = new byte[1024];
				InputStream inputStream = socket.getInputStream();
				
				while(true){
					//è¯»å–æ•°æ®ï¼ˆé˜»å¡ï¼‰
					int read = inputStream.read(bytes);
					if(read != -1){
						System.out.println(new String(bytes, 0, read));
					}else{
						break;
					}
				}
			} catch (Exception e) {
				e.printStackTrace();
			}finally{
				try {
					System.out.println("socketå…³é—­");
					socket.close();
				} catch (IOException e) {
					e.printStackTrace();
				}
			}
	}
}

```
ä¸Šé¢ä¸ºä¿®æ”¹åçš„ä»£ç ã€‚å¦‚æœä¸å°†handler(socket);æ”¾åœ¨çº¿ç¨‹æ± ä¸­

æ‰“å¼€ç¬¬ä¸€ä¸ªtelnet 
cmd
```js
telnet 127.0.0.1 10101 
```
eclisepç»ˆç«¯

```js
æœåŠ¡å™¨å¯åŠ¨ï¼
æ¥äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯
```

é€šè¿‡æ–­ç‚¹æ‰§è¡Œï¼Œæ–­ç‚¹æ‰§è¡Œåˆ°readå½¢æˆäº†é˜»å¡
å†æ‰“å¼€ç¬¬äºŒä¸ªtelnet
cmd
```js
telnet 127.0.0.1 10101 
```
eclipseç»ˆç«¯æ²¡æœ‰ä»»ä½•ååº”ï¼Œè¯´æ˜æ²¡æœ‰è¿ä¸Šå®¢æˆ·ç«¯ï¼Œå› ä¸ºå·²ç»é˜»å¡åœ¨ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯çš„readå‡½æ•°ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½è¿”å›åˆ°acceptï¼ˆï¼‰
è¿™ä¸ªæ—¶å€™åœ¨ç¬¬ä¸€ä¸ªtelnetä¸­

```js
send hello
```
eclipseç»ˆç«¯
```js
æœåŠ¡å™¨å¯åŠ¨ï¼
æ¥äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯
hello
```
ä½†æ˜¯ç¬¬äºŒä¸ªè¿˜æ˜¯è¿›ä¸æ¥ï¼Ÿ

é‚£æ˜¯ä¸æ˜¯å¯ä»¥å§handlerä¿®æ”¹æˆä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡å‘¢ï¼Ÿæ¥ä¸€ä¸ªsocketå°±ä¸ºè¿™ä¸ªsockeæœåŠ¡
é€šè¿‡çº¿ç¨‹æ± ï¼Œå°†ä»»åŠ¡æ·»åŠ è¿›å…¥çº¿ç¨‹æ± å†çœ‹ç»“æœ
é‡å¤ä¸Šé¢çš„æ“ä½œ

```js
telnet 127.0.0.1 10101
```

```js
æœåŠ¡å™¨å¯åŠ¨ï¼
æ¥äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯
```
send hello
```js
æœåŠ¡å™¨å¯åŠ¨ï¼
æ¥äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯
hello
```
å†å¼€å¯ä¸€ä¸ªtelnet

```js
telnet 127.0.0.1 10101
```

```js
æœåŠ¡å™¨å¯åŠ¨ï¼
æ¥äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯
hello
æ¥äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯
```
send abc
```js
æœåŠ¡å™¨å¯åŠ¨ï¼
æ¥äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯
hello
æ¥äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯
abc
```
### å¼Šç«¯
ä¸Šé¢è™½ç„¶æŠŠhandler(socket);æ”¾åˆ°äº†çº¿ç¨‹æ± ä¸­ï¼Œä½¿å¾—å¤šä¸ªsocketèƒ½å¤Ÿè¿›è¡Œè¿æ¥ï¼Œå¯æ˜¯æ¯ä¸ªsocketéœ€è¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå‡å¦‚æŠŠç³»ç»Ÿæ¯”ä½œæ˜¯ä¸€ä¸ªé¤å…çš„è¯ï¼Œæ¥ä¸€å®¢äººå°±å®‰æ’ä¸€ä¸ªæœåŠ¡ç”Ÿä¸“é—¨æ¥å¾…è¿™ä¸ªå®¢äººï¼Œåˆæ¥ä¸€ä¸ªæ–°çš„å®¢äººåˆå®‰æ’ä¸€ä¸ªæ–°çš„æœåŠ¡ç”Ÿï¼Œè¿™æ ·çš„æ¶ˆè€—å¾ˆå¤§ï¼Œå®¢äººè¶Šæ¥è¶Šå¤šï¼Œé¥­åº—è¿Ÿæ—©ä¸€å¤©ä¼šé»„äº†çš„
æ‰€ä»¥ä¼ ç»Ÿçš„socketä¸èƒ½åšé•¿è¿æ¥çš„æœåŠ¡å™¨ï¼Œä½†æ˜¯å¯ä»¥åšçŸ­è¿æ¥çš„æœåŠ¡å™¨ã€‚
ä¾‹å¦‚è€çš„tomcatï¼Œåº•å±‚æ˜¯ç”¨socketï¼Œå› ä¸ºæ˜¯ä¸€é—®ä¸€ç­”æœºåˆ¶ï¼Œå®¢æˆ·ç«¯å‘ä¸€ä¸ªæ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯å›äº†ä»¥åå°±å¯ä»¥å…³æ‰ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°çº¿ç¨‹ä¸€ç›´è¢«ä¸€ä¸ªå®¢æˆ·ç«¯å ç”¨çš„æƒ…å†µï¼Œä¸€ä¸ªçº¿ç¨‹æ˜¯å¯ä»¥ä¸ºå¤šä¸ªå®¢æˆ·ç«¯å¤„ç†ä»»åŠ¡çš„
## æ€»ç»“
é˜»å¡ç‚¹
- server.accept();
- inputStream.read(bytes);

å•çº¿ç¨‹æƒ…å†µä¸‹åªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯
ç”¨çº¿ç¨‹æ± å¯ä»¥æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œä½†æ˜¯éå¸¸æ¶ˆè€—æ€§èƒ½
# NIOä»£ç åˆ†æ
## ä¸¾ä¸ªğŸŒ°

```js
package NIO;

import java.io.IOException;
import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.SelectionKey;
import java.nio.channels.Selector;
import java.nio.channels.ServerSocketChannel;
import java.nio.channels.SocketChannel;
import java.util.Iterator;

/**
 * NIOæœåŠ¡ç«¯
 * 
 * 
 */
public class NIOServer {
	// é€šé“ç®¡ç†å™¨
	private Selector selector;

	/**
	 * è·å¾—ä¸€ä¸ªServerSocketé€šé“ï¼Œå¹¶å¯¹è¯¥é€šé“åšä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œ
	 * 
	 * @param port
	 *            ç»‘å®šçš„ç«¯å£å·
	 * @throws IOException
	 */
	public void initServer(int port) throws IOException {
		// è·å¾—ä¸€ä¸ªServerSocketé€šé“ï¼ŒServerSocketChannelæƒ³åˆ°ä¸æ™®é€šioçš„ServerSocket
		ServerSocketChannel serverChannel = ServerSocketChannel.open();
		// è®¾ç½®é€šé“ä¸ºéé˜»å¡
		serverChannel.configureBlocking(false);
		// å°†è¯¥é€šé“å¯¹åº”çš„ServerSocketç»‘å®šåˆ°portç«¯å£
		serverChannel.socket().bind(new InetSocketAddress(port));
		// è·å¾—ä¸€ä¸ªé€šé“ç®¡ç†å™¨
		this.selector = Selector.open();
		// å°†é€šé“ç®¡ç†å™¨å’Œè¯¥é€šé“ç»‘å®šï¼Œå¹¶ä¸ºè¯¥é€šé“æ³¨å†ŒSelectionKey.OP_ACCEPTäº‹ä»¶,æ³¨å†Œè¯¥äº‹ä»¶åï¼Œ
		// å½“è¯¥äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œselector.select()ä¼šè¿”å›ï¼Œå¦‚æœè¯¥äº‹ä»¶æ²¡åˆ°è¾¾selector.select()ä¼šä¸€ç›´é˜»å¡ã€‚
		serverChannel.register(selector, SelectionKey.OP_ACCEPT);
	}

	/**
	 * é‡‡ç”¨è½®è¯¢çš„æ–¹å¼ç›‘å¬selectorä¸Šæ˜¯å¦æœ‰éœ€è¦å¤„ç†çš„äº‹ä»¶ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿›è¡Œå¤„ç†
	 * 
	 * @throws IOException
	 */
	public void listen() throws IOException {
		System.out.println("æœåŠ¡ç«¯å¯åŠ¨æˆåŠŸï¼");
		// è½®è¯¢è®¿é—®selector
		while (true) {
			// å½“æ³¨å†Œçš„äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œæ–¹æ³•è¿”å›ï¼›å¦åˆ™,è¯¥æ–¹æ³•ä¼šä¸€ç›´é˜»å¡
			//ç‚¹ä¸è¿›å»selectæ–¹æ³•ï¼Œå› ä¸ºåº•å±‚æ˜¯cå†™çš„
			selector.select();
			// è·å¾—selectorä¸­é€‰ä¸­çš„é¡¹çš„è¿­ä»£å™¨ï¼Œé€‰ä¸­çš„é¡¹ä¸ºæ³¨å†Œçš„äº‹ä»¶
			Iterator<?> ite = this.selector.selectedKeys().iterator();
			while (ite.hasNext()) {
				SelectionKey key = (SelectionKey) ite.next();
				// åˆ é™¤å·²é€‰çš„key,ä»¥é˜²é‡å¤å¤„ç†
				ite.remove();

				handler(key);
			}
		}
	}

	/**
	 * å¤„ç†è¯·æ±‚
	 * 
	 * @param key
	 * @throws IOException
	 */
	public void handler(SelectionKey key) throws IOException {
		
		// å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥äº‹ä»¶
		if (key.isAcceptable()) {
			handlerAccept(key);
			// è·å¾—äº†å¯è¯»çš„äº‹ä»¶
		} else if (key.isReadable()) {
			handelerRead(key);
		}
	}

	/**
	 * å¤„ç†è¿æ¥è¯·æ±‚
	 * 
	 * @param key
	 * @throws IOException
	 */
	public void handlerAccept(SelectionKey key) throws IOException {
		ServerSocketChannel server = (ServerSocketChannel) key.channel();
		// è·å¾—å’Œå®¢æˆ·ç«¯è¿æ¥çš„é€šé“ï¼ŒSocketChannelç›¸å½“äºä¼ ç»Ÿioé‡Œé¢çš„Channel
		SocketChannel channel = server.accept();
		// è®¾ç½®æˆéé˜»å¡
		channel.configureBlocking(false);

		// åœ¨è¿™é‡Œå¯ä»¥ç»™å®¢æˆ·ç«¯å‘é€ä¿¡æ¯å“¦
		System.out.println("æ–°çš„å®¢æˆ·ç«¯è¿æ¥");
		// åœ¨å’Œå®¢æˆ·ç«¯è¿æ¥æˆåŠŸä¹‹åï¼Œä¸ºäº†å¯ä»¥æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œéœ€è¦ç»™é€šé“è®¾ç½®è¯»çš„æƒé™ã€‚
		channel.register(this.selector, SelectionKey.OP_READ);
	}

	/**
	 * å¤„ç†è¯»çš„äº‹ä»¶
	 * 
	 * @param key
	 * @throws IOException
	 */
	public void handelerRead(SelectionKey key) throws IOException {
		// æœåŠ¡å™¨å¯è¯»å–æ¶ˆæ¯:å¾—åˆ°äº‹ä»¶å‘ç”Ÿçš„Socketé€šé“
		SocketChannel channel = (SocketChannel) key.channel();
		// åˆ›å»ºè¯»å–çš„ç¼“å†²åŒº
		ByteBuffer buffer = ByteBuffer.allocate(1024);
		int read = channel.read(buffer);
		if(read > 0){
			byte[] data = buffer.array();
			String msg = new String(data).trim();
			System.out.println("æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š" + msg);
			
			//å›å†™æ•°æ®
			ByteBuffer outBuffer = ByteBuffer.wrap("å¥½çš„".getBytes());
			channel.write(outBuffer);// å°†æ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯
		}else{
			System.out.println("å®¢æˆ·ç«¯å…³é—­");
			key.cancel();
		}
	}

	/**
	 * å¯åŠ¨æœåŠ¡ç«¯æµ‹è¯•
	 * 
	 * @throws IOException
	 */
	public static void main(String[] args) throws IOException {
		NIOServer server = new NIOServer();
		server.initServer(8000);
		server.listen();
	}

}

```
æµ‹è¯•ï¼š
é€šè¿‡telnet å¤šæ¬¡è¿æ¥ï¼Œéƒ½å¯ä»¥æˆåŠŸ
## ä¸¾ä¸ªğŸŒ°
NIOçš„ç‰¹ç‚¹

ServerSocketChannel	 ç›¸å½“äºServerSocket

SocketChannelç›¸å½“äºSocket

Selector  ä½¿å¾—NIOèƒ½å¤Ÿé€šè¿‡å•çº¿ç¨‹ä¸ºå¤šä¸ªå®¢æˆ·ç«¯æœåŠ¡

SelectionKey 
# å›¾è§£IO/NIO
## IO
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RhdGFpeWFuZ3U=,size_16,color_FFFFFF,t_70-20190312194241409.png)
## NIO
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](../images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RhdGFpeWFuZ3U=,size_16,color_FFFFFF,t_70-20190312194241407.png)
selectorç›‘æ§ç€å¤§é—¨ï¼ˆacceptï¼‰å’Œå®¢äººï¼Œå¾…åœ¨å²—ä½ä¸Šç­‰å¾…å®¢äºº
```js
selector.select();
```
å®¢äººè¿›åº—ä¹‹åå…ˆåœ¨å¤§é—¨è¿™é‡Œæ³¨å†Œä¸€ä¸ªreadäº‹ä»¶ï¼Œç›¸å½“äºè¯´äº†ä¸€å£°â€æ¬¢è¿å…‰ä¸´â€œï¼Œå¸®åŠ©å®¢äººèµ°åˆ°åº§ä½ä¸Šï¼Œç„¶åå®¢äººæœ‰éœ€æ±‚çš„è¯éšæ—¶å¾…å‘½

```js
channel.register(this.selector, SelectionKey.OP_READ);
```
ç„¶åå°±æ¥ç€å›åˆ°åŸæ¥çš„å²—ä½ä¸Šå¾…å‘½

```js
selector.select();
```

ç„¶åæœåŠ¡å‘˜å°±å¯ä»¥èµ°äº†ï¼Œæˆ‘ç‚¹èœï¼ˆreadçš„æ—¶å€™ï¼‰äº†å†å«ä½ 
å®¢äººç‚¹èœ--ã€‹tlnet

```js
//æƒ³è¦è¿ç»­å‘é€ï¼Œç¬¬ä¸€æ¬¡å›æ’¤ä¹‹åï¼Œéœ€è¦å…ˆé€€å‡ºå½“å‰é¡µé¢ä¸€æ¬¡ï¼Œç„¶åé€šè¿‡ç»ˆç«¯å†æ¬¡send ï¼ˆwin7ï¼‰
send wo yao chi fan 
```
ç„¶åå®¢æˆ·ç«¯è¿›è¡Œè¯»èœå•ï¼ˆreadæ“ä½œï¼‰

```js
soutï¼ˆâ€œxxxxxxâ€ï¼‰
```
# å…³äºNIOçš„ä¸€äº›ç–‘æƒ‘
## å®¢æˆ·ç«¯å…³é—­çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ­»å¾ªç¯
è¿è¡Œä¸Šé¢çš„ç¨‹åºï¼Œæ‰“å¼€tlnet

```js
send hello
```
ç„¶åå…³é—­æ‰å½“å‰tlnetçª—å£
æŠ¥é”™ï¼š

```js
java.io.IOException:æ‚¨çš„ä¸»æœºä¸­çš„è½¯ä»¶ç»ˆæ­¢äº†ä¸€ä¸ªå·²å»ºç«‹çš„è¿æ¥
```

```js
public void handelerRead(SelectionKey key) throws IOException {
		// æœåŠ¡å™¨å¯è¯»å–æ¶ˆæ¯:å¾—åˆ°äº‹ä»¶å‘ç”Ÿçš„Socketé€šé“
		SocketChannel channel = (SocketChannel) key.channel();
		// åˆ›å»ºè¯»å–çš„ç¼“å†²åŒº
		ByteBuffer buffer = ByteBuffer.allocate(1024);
		int read = channel.read(buffer);
		if(read > 0){
			byte[] data = buffer.array();
			String msg = new String(data).trim();
			System.out.println("æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š" + msg);
			
			//å›å†™æ•°æ®
			ByteBuffer outBuffer = ByteBuffer.wrap("å¥½çš„".getBytes());
			channel.write(outBuffer);// å°†æ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯
		}else{
			System.out.println("å®¢æˆ·ç«¯å…³é—­");
			key.cancel();
		}
	}
```
å› ä¸ºä¼šå†™æ•°æ®è¿™é‡Œå‡ºé”™ï¼Œå¯ä»¥å°†å…¶æ³¨é‡Šæ‰

```js
//å›å†™æ•°æ®
			ByteBuffer outBuffer = ByteBuffer.wrap("å¥½çš„".getBytes());
			channel.write(outBuffer);// å°†æ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯
```
ç´§æ¥ç€åŸæ¥çš„é”™è¯¯æ²¡æœ‰äº†å¯æ˜¯ä¼šå‡ºç°ä¸åœçš„æ­»å¾ªç¯

```js
æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š
æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š
æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š
æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š
æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š
æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š
æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š
æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š
```
è§£å†³æ–¹æ¡ˆï¼š

```js
int read = channel.read(buffer);
		if(read > 0){
			byte[] data = buffer.array();
			String msg = new String(data).trim();
			System.out.println("æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼š" + msg);
			
			//å›å†™æ•°æ®
			ByteBuffer outBuffer = ByteBuffer.wrap("å¥½çš„".getBytes());
			channel.write(outBuffer);// å°†æ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯
		}else{
			System.out.println("å®¢æˆ·ç«¯å…³é—­");
			key.cancel();
		}
```
åº”è¯¥å¯¹æ”¶åˆ°çš„æ•°æ®åšä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°±å°†keyå–æ¶ˆã€‚
## selector.select();é˜»å¡ï¼Œé‚£ä¸ºä»€ä¹ˆè¯´nioæ˜¯éé˜»å¡çš„IOï¼Ÿ
åˆ¤æ–­ioæ˜¯ä¸æ˜¯é˜»å¡çš„ç‚¹ï¼Œä¸æ˜¯acceptæˆ–è€…selectorï¼Œè€Œæ˜¯è¯»å–æ•°æ®çš„æ—¶å€™æ˜¯å¦èƒ½å¤Ÿç«‹é©¬è¿”å›ï¼Œä»ä¸Šé¢çš„é—®é¢˜çŸ¥é“ï¼Œå³ä½¿æ²¡æœ‰æ•°æ®è¾“å…¥ä¹Ÿæ˜¯ä¼šç«‹å³è¿”å›çš„ï¼Œä½†æ˜¯ä¼ ç»Ÿçš„ioæ˜¯ä¼šé˜»å¡åœ¨å“ªé‡Œçš„
	selector.select()
	selectï¼ˆï¼‰å¯ä»¥éé˜»å¡ï¼Œå¸¦æœ‰å‚æ•°å³å¯å˜æˆéé˜»å¡
	selector.select(1000);ä¸é˜»å¡ï¼Œåœ¨ä¸€ç§’å†…å†…æœ‰å‘é€è¯·æ±‚ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šè¿”å›ï¼Œåªä¸è¿‡è¿”å›çš„æ˜¯é›¶ã€‚
	selector.wakeup();ä¹Ÿå¯ä»¥å”¤é†’selectorï¼Œå¦‚æœå½“å‰çš„selectoræ˜¯é˜»å¡çŠ¶æ€çš„ï¼Œç”¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨åä¼šç«‹å³è¿”å›ã€‚
	selector.selectNow();ä¹Ÿå¯ä»¥ç«‹é©¬è¿”è¿˜ï¼Œè§†é¢‘é‡Œå¿˜äº†è®²äº†ï¼Œå“ˆï¼Œè¿™é‡Œè¡¥ä¸Š


## SelectionKey.OP_WRITEæ˜¯ä»£è¡¨ä»€ä¹ˆæ„æ€
 **<font color="red">ä¸€èˆ¬writeæ–¹æ³•ç”¨çš„å¾ˆå°‘ï¼Œå†™æ•°æ®çš„æ—¶å€™ä¹Ÿä¸éœ€è¦æ³¨å†Œwriteäº‹ä»¶ã€‚   </font>**

OP_WRITEè¡¨ç¤ºåº•å±‚ç¼“å†²åŒºæ˜¯å¦æœ‰ç©ºé—´ï¼Œæ˜¯åˆ™å“åº”è¿”è¿˜trueï¼ˆä¸€èˆ¬éƒ½æ˜¯æœ‰ç©ºé—´çš„ï¼Œå³ä¸€èˆ¬æ˜¯trueï¼‰

```js
System.out.println("isWriteabl"+key.isWritable)
```
è¾“å‡º
```js
false
```
å› ä¸ºæ²¡æœ‰ç»™selectoræ³¨å†Œè¿™ä¸ªäº‹ä»¶ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯false
æ¯”å¦‚é¤å…é‡Œé¢çš„ç­·å­æ‰äº†ï¼Œç»ç†æ²¡è®©ä½ ç®¡ï¼Œä½ å°±å‡è£…ä¸çŸ¥é“ï¼Œä½†æ˜¯ç»ç†å‘Šè¯‰ä½ ç­·å­æ‰äº†ï¼ˆæ³¨å†Œï¼‰ï¼Œä½ å°±éœ€è¦æ¡èµ·æ¥

```js
channel.register(this.selector,SelectionKey.OP_WRITE)
```

```js
isWriteabl true
isWriteabl true
isWriteabl true
isWriteabl true
isWriteabl true
isWriteabl true
```
å°±æ˜¯åˆ¤æ–­ç¼“å†²åŒºæœ‰æ²¡æœ‰ç©ºé—´ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šæ³¨å†Œwriteäº‹ä»¶