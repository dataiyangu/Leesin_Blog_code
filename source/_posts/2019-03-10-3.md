
title: åŸºäºNettyçš„RPCæ¶æ„å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šnettyå®¢æˆ·ç«¯
author: Leesin.Dong
top: 
tags:
  - Netty
categories:
  - å­¦ä¹ ç¬”è®°
  - åŸºäºNettyçš„RPCæ¶æ„å­¦ä¹ ç¬”è®°
date: 2019-3-10 10:21:03

---

# ä¸¾ä¸ªğŸŒ°
Client.java

```js
package com.client;

import java.net.InetSocketAddress;
import java.util.Scanner;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import org.jboss.netty.bootstrap.ClientBootstrap;
import org.jboss.netty.channel.Channel;
import org.jboss.netty.channel.ChannelFuture;
import org.jboss.netty.channel.ChannelPipeline;
import org.jboss.netty.channel.ChannelPipelineFactory;
import org.jboss.netty.channel.Channels;
import org.jboss.netty.channel.socket.nio.NioClientSocketChannelFactory;
import org.jboss.netty.handler.codec.string.StringDecoder;
import org.jboss.netty.handler.codec.string.StringEncoder;
/**

- nettyå®¢æˆ·ç«¯å…¥é—¨

- =
  *
   */
  public class Client {

  public static void main(String[] args) {
  	


  //æœåŠ¡ç±»
  ClientBootstrap bootstrap = new  ClientBootstrap();
  
  //çº¿ç¨‹æ± 
  ExecutorService boss = Executors.newCachedThreadPool();
  ExecutorService worker = Executors.newCachedThreadPool();
  
  //socketå·¥å‚
  bootstrap.setFactory(new NioClientSocketChannelFactory(boss, worker));
  
  //ç®¡é“å·¥å‚
  bootstrap.setPipelineFactory(new ChannelPipelineFactory() {
  	
  	@Override
  	public ChannelPipeline getPipeline() throws Exception {
  		ChannelPipeline pipeline = Channels.pipeline();
  		pipeline.addLast("decoder", new StringDecoder());
  		pipeline.addLast("encoder", new StringEncoder());
  		pipeline.addLast("hiHandler", new HiHandler());
  		return pipeline;
  	}
  });
  
  //è¿æ¥æœåŠ¡ç«¯
  ChannelFuture connect = bootstrap.connect(new InetSocketAddress("127.0.0.1", 10101));
  Channel channel = connect.getChannel();
  
  System.out.println("client start");
  
  Scanner scanner = new Scanner(System.in);
  while(true){
  	System.out.println("è¯·è¾“å…¥");
  	channel.write(scanner.next());
  }


  }

}
```
HiHandler.java
```js
package com.client;

import org.jboss.netty.channel.ChannelHandlerContext;
import org.jboss.netty.channel.ChannelStateEvent;
import org.jboss.netty.channel.ExceptionEvent;
import org.jboss.netty.channel.MessageEvent;
import org.jboss.netty.channel.SimpleChannelHandler;
/**

- æ¶ˆæ¯æ¥å—å¤„ç†ç±»

- =
  *
   */
  public class HiHandler extends SimpleChannelHandler {

  /**

  - æ¥æ”¶æ¶ˆæ¯
    */
    @Override
    public void messageReceived(ChannelHandlerContext ctx, MessageEvent e) throws Exception {

    String s = (String) e.getMessage();
    System.out.println(s);

    super.messageReceived(ctx, e);
    }

  /**

  - æ•è·å¼‚å¸¸
    */
    @Override
    public void exceptionCaught(ChannelHandlerContext ctx, ExceptionEvent e) throws Exception {
    System.out.println("exceptionCaught");
    super.exceptionCaught(ctx, e);
    }

  /**

  - æ–°è¿æ¥
    */
    @Override
    public void channelConnected(ChannelHandlerContext ctx, ChannelStateEvent e) throws Exception {
    System.out.println("channelConnected");
    super.channelConnected(ctx, e);
    }

  /**

  - å¿…é¡»æ˜¯é“¾æ¥å·²ç»å»ºç«‹ï¼Œå…³é—­é€šé“çš„æ—¶å€™æ‰ä¼šè§¦å‘
    */
    @Override
    public void channelDisconnected(ChannelHandlerContext ctx, ChannelStateEvent e) throws Exception {
    System.out.println("channelDisconnected");
    super.channelDisconnected(ctx, e);
    }

  /**

  - channelå…³é—­çš„æ—¶å€™è§¦å‘
    */
    @Override
    public void channelClosed(ChannelHandlerContext ctx, ChannelStateEvent e) throws Exception {
    System.out.println("channelClosed");
    super.channelClosed(ctx, e);
    }
    }
```
channelDisconnectedä¸channelClosedçš„åŒºåˆ«ï¼Ÿ
channelDisconnectedåªæœ‰åœ¨è¿æ¥å»ºç«‹åæ–­å¼€æ‰ä¼šè°ƒç”¨
channelClosedæ— è®ºè¿æ¥æ˜¯å¦æˆåŠŸéƒ½ä¼šè°ƒç”¨å…³é—­èµ„æº
åœ¨è¿™é‡ŒéªŒè¯ä¸‹ï¼š
å½“serveræ²¡æœ‰å¼€å¯çš„æ—¶å€™ï¼Œclientå»è¯·æ±‚ï¼Œå‘ç°æŠ¥é”™ï¼Œç„¶ååªæ‰“å°äº†channelClosedï¼Œè€Œæ²¡æœ‰æ‰“å°channelConnected
serverå¼€å¯å¹¶clientå’Œserveræ­£å¸¸äº¤äº’åå°†æœåŠ¡ç«¯æ–­å¼€ä¼šæ‰“å°channelDisconnected